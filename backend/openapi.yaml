openapi: 3.0.3
info:
  title: Serverless E-Commerce API
  version: 1.0.0
  description: >
    REST API specification for a serverless e-commerce website using AWS API Gateway,
    Lambda, DynamoDB, Cognito JWT authentication, and Step Functions for order workflows.

servers:
  - url: https://api.example.com

tags:
  - name: Products
  - name: Cart
  - name: Checkout
  - name: Orders
  - name: Admin

paths:

  /products:
    get:
      summary: Get all products
      tags: [Products]
      security:
        - cognitoAuth: []
      parameters:
        - in: query
          name: limit
          schema: { type: integer }
        - in: query
          name: lastKey
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Product"
                  lastKey:
                    type: string
        "500": { description: Server Error }

  /products/{id}:
    get:
      summary: Get product by ID
      tags: [Products]
      security:
        - cognitoAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
        "404": { description: Product not found }
        "500": { description: Server error }

  /admin/products:
    post:
      summary: Create product (Admin)
      tags: [Admin]
      security:
        - cognitoAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductCreateRequest"
      responses:
        "201": { description: Created }
        "400": { description: Invalid input }
        "403": { description: Forbidden }

  /cart:
    get:
      summary: Get user's cart
      tags: [Cart]
      security:
        - cognitoAuth: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        "500": { description: Server Error }

    post:
      summary: Add/update cart item
      tags: [Cart]
      security:
        - cognitoAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CartUpdateRequest"
      responses:
        "200": { description: Updated }
        "400": { description: Invalid input }
        "500": { description: Server Error }

  /checkout/start:
    post:
      summary: Start checkout workflow
      tags: [Checkout]
      security:
        - cognitoAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckoutRequest"
      responses:
        "200":
          description: Checkout initialized
          content:
            application/json:
              schema:
                type: object
                properties:
                  executionArn: { type: string }
                  orderDraftId: { type: string }
        "400": { description: Bad request }
        "500": { description: Server Error }

  /orders:
    get:
      summary: List user orders
      tags: [Orders]
      security:
        - cognitoAuth: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Order" }

components:

  securitySchemes:
    cognitoAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    Product:
      type: object
      required: [id, name, price]
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        price: { type: number }
        category: { type: string }
        stockCount: { type: integer }
        images:
          type: array
          items: { type: string }

    ProductCreateRequest:
      type: object
      required: [name, price, category]
      properties:
        name: { type: string }
        description: { type: string }
        price: { type: number }
        category: { type: string }
        stockCount: { type: integer }
        images:
          type: array
          items: { type: string }

    Cart:
      type: object
      properties:
        userId: { type: string }
        items:
          type: array
          items:
            $ref: "#/components/schemas/CartItem"

    CartItem:
      type: object
      required: [productId, qty]
      properties:
        productId: { type: string }
        qty: { type: integer }
        priceAtAdd: { type: number }

    CartUpdateRequest:
      type: object
      required: [productId, qty]
      properties:
        productId: { type: string }
        qty: { type: integer }

    CheckoutRequest:
      type: object
      required: [paymentMethodId]
      properties:
        paymentMethodId: { type: string }

    Order:
      type: object
      required: [orderId, status, items]
      properties:
        orderId: { type: string }
        userId: { type: string }
        status: { type: string }
        items:
          type: array
          items:
            $ref: "#/components/schemas/CartItem"
        totalAmount: { type: number }
        createdAt: { type: string }

